---
name: tool-design
description: このスキルは、ユーザーが「エージェントツールを設計する」「ツール記述を作成する」「ツールの複雑さを軽減する」「MCPツールを実装する」と依頼した場合、またはツール統合、アーキテクチャ削減、ツール命名規則、エージェント-ツールインターフェースに言及した場合に使用します。
---

# エージェント向けツール設計

ツールは、エージェントが外部世界とやり取りするための主要なメカニズムです。ツールは決定論的システムと非決定論的エージェントの間の契約を定義します。開発者向けに設計された従来のソフトウェアAPIとは異なり、ツールAPIは意図を推論し、パラメータ値を推測し、自然言語のリクエストから呼び出しを生成する言語モデル向けに設計する必要があります。不適切なツール設計は、どれだけプロンプトエンジニアリングを行っても修正できない障害モードを生み出します。効果的なツール設計は、エージェントがツールをどのように認識し使用するかを考慮した特定の原則に従います。

## アクティベーション条件

以下の場合にこのスキルをアクティベートしてください：
- エージェントシステム用の新しいツールを作成する場合
- ツール関連の障害や誤用をデバッグする場合
- エージェントのパフォーマンス向上のために既存のツールセットを最適化する場合
- ツールAPIをゼロから設計する場合
- エージェント統合のためにサードパーティツールを評価する場合
- コードベース全体でツール規則を標準化する場合

## コアコンセプト

ツールは決定論的システムと非決定論的エージェントの間の契約です。統合原則は、人間のエンジニアが特定の状況でどのツールを使用すべきか明確に判断できない場合、エージェントにそれ以上の判断を期待することはできないと述べています。効果的なツール記述は、エージェントの振る舞いを形作るプロンプトエンジニアリングです。

主要な原則には以下が含まれます：何を、いつ、何を返すかに答える明確な記述、完全性とトークン効率のバランスを取るレスポンスフォーマット、リカバリーを可能にするエラーメッセージ、認知負荷を軽減する一貫した規則。

## 詳細トピック

### ツール-エージェントインターフェース

**契約としてのツール**
ツールは決定論的システムと非決定論的エージェントの間の契約です。人間がAPIを呼び出す際は契約を理解し適切なリクエストを行います。エージェントは記述から契約を推論し、期待されるフォーマットに一致する呼び出しを生成する必要があります。

この根本的な違いにより、API設計の再考が必要になります。契約は曖昧さがないものでなければならず、例は期待されるパターンを示し、エラーメッセージは修正を導く必要があります。ツール定義のあらゆる曖昧さが潜在的な障害モードとなります。

**プロンプトとしてのツール記述**
ツール記述はエージェントのコンテキストにロードされ、全体として振る舞いを導きます。記述は単なるドキュメントではなく、エージェントがツール使用についてどのように推論するかを形作るプロンプトエンジニアリングです。

「データベースを検索する」のような不適切な記述と暗号的なパラメータ名は、エージェントに推測を強います。最適化された記述には使用コンテキスト、例、デフォルト値が含まれます。記述は次の質問に答えます：ツールが何をするか、いつ使用するか、何を生成するか。

**名前空間と整理**
ツールコレクションが増えるにつれ、整理が重要になります。名前空間は関連するツールを共通のプレフィックスでグループ化し、エージェントが適切なタイミングで適切なツールを選択するのを助けます。

名前空間は機能間に明確な境界を作ります。エージェントがデータベース情報を必要とする場合はデータベースの名前空間にルーティングし、ウェブ検索が必要な場合はウェブの名前空間にルーティングします。

### 統合原則

**単一の包括的ツール**
統合原則は、人間のエンジニアが特定の状況でどのツールを使用すべきか明確に判断できない場合、エージェントにそれ以上の判断を期待することはできないと述べています。これにより、複数の狭いツールよりも単一の包括的ツールが優先されます。

list_users、list_events、create_eventを個別に実装する代わりに、空き状況を確認してスケジュールするschedule_eventを実装します。包括的ツールは、エージェントに複数の呼び出しをチェーンさせるのではなく、完全なワークフローを内部で処理します。

**統合が機能する理由**
エージェントのコンテキストと注意力は限られています。コレクション内の各ツールはツール選択フェーズで注意力を競い合います。各ツールはコンテキスト予算を消費する記述トークンを追加します。重複する機能はどのツールを使用するかについて曖昧さを生みます。

統合は冗長な記述を排除することでトークン消費を削減します。各ワークフローを1つのツールがカバーすることで曖昧さを排除します。有効なツールセットを縮小することでツール選択の複雑さを軽減します。

**統合すべきでない場合**
統合は常に正しいわけではありません。根本的に異なる振る舞いを持つツールは分離したままにすべきです。異なるコンテキストで使用されるツールは分離の恩恵を受けます。独立して呼び出される可能性のあるツールは人工的にバンドルすべきではありません。

### アーキテクチャ削減

統合原則を論理的な極限まで推し進めると、アーキテクチャ削減に至ります：ほとんどの専門化されたツールを排除し、プリミティブで汎用的な機能を優先します。本番環境の実績は、このアプローチが洗練されたマルチツールアーキテクチャを上回る可能性があることを示しています。

**ファイルシステムエージェントパターン**
データ探索、スキーマ検索、クエリ検証のためのカスタムツールを構築する代わりに、単一のコマンド実行ツールを通じて直接ファイルシステムアクセスを提供します。エージェントは標準的なUnixユーティリティ（grep、cat、find、ls）を使用してシステムを探索、理解、操作します。

これが機能する理由：
1. ファイルシステムはモデルが深く理解している実証済みの抽象化である
2. 標準ツールは予測可能で十分にドキュメント化された振る舞いを持つ
3. エージェントは事前定義されたワークフローに制約されるのではなく、プリミティブを柔軟にチェーンできる
4. ファイル内の良質なドキュメントが要約ツールの必要性を置き換える

**削減が複雑さを上回る場合**
削減が機能する場合：
- データレイヤーが十分にドキュメント化され、一貫して構造化されている場合
- モデルが複雑さを処理するための十分な推論能力を持っている場合
- 専門化されたツールがモデルを有効化するのではなく制約していた場合
- 成果の改善よりもスキャフォールディングの維持に多くの時間を費やしている場合

削減が失敗する場合：
- 基礎データが乱雑で、一貫性がなく、ドキュメント化が不十分な場合
- ドメインがモデルに欠けている専門知識を必要とする場合
- 安全制約によりエージェントができることを制限する必要がある場合
- 操作が本当に複雑で、構造化されたワークフローの恩恵を受ける場合

**推論の制約を止める**
よくあるアンチパターンは、モデルを複雑さから「保護」するためのツールを構築することです。コンテキストの事前フィルタリング、オプションの制約、バリデーションロジックでのインタラクションのラッピング。これらのガードレールは、モデルが改善されるにつれて負債になることがよくあります。

問うべき質問：あなたのツールは新しい機能を有効にしているのか、それともモデルが自力で処理できる推論を制約しているのか？

**将来のモデルに向けて構築する**
モデルはツールが追いつけるよりも速く改善されます。今日のモデルに最適化されたアーキテクチャは、明日のモデルには過度に制約されている可能性があります。現在の制限を固定する洗練されたアーキテクチャではなく、モデルの改善から恩恵を受けることができる最小限のアーキテクチャを構築してください。

本番環境の実績については[アーキテクチャ削減ケーススタディ](./references/architectural_reduction.md)を参照してください。

### ツール記述エンジニアリング

**記述の構造**
効果的なツール記述は4つの質問に答えます：

ツールは何をするか？機能の明確で具体的な記述。「〜に役立つ」や「〜に使用できる」のような曖昧な表現を避けてください。ツールが達成することを正確に述べてください。

いつ使用すべきか？具体的なトリガーとコンテキスト。直接的なトリガー（「ユーザーが価格について質問する」）と間接的なシグナル（「現在の市場レートが必要」）の両方を含めてください。

どのような入力を受け付けるか？型、制約、デフォルト値を含むパラメータの記述。各パラメータが何を制御するかを説明してください。

何を返すか？出力フォーマットと構造。成功レスポンスとエラー条件の例を含めてください。

**デフォルトパラメータの選択**
デフォルト値は一般的なユースケースを反映すべきです。不必要なパラメータ指定を排除することでエージェントの負担を軽減します。省略されたパラメータによるエラーを防止します。

### レスポンスフォーマットの最適化

ツールのレスポンスサイズはコンテキスト使用量に大きく影響します。レスポンスフォーマットオプションを実装することで、エージェントに冗長性の制御を委ねます。

簡潔フォーマットは必須フィールドのみを返し、確認や基本情報に適しています。詳細フォーマットはすべてのフィールドを含む完全なオブジェクトを返し、意思決定に完全なコンテキストが必要な場合に適しています。

各フォーマットをいつ使用するかのガイダンスをツール記述に含めてください。エージェントはタスク要件に基づいて適切なフォーマットを選択することを学習します。

### エラーメッセージ設計

エラーメッセージには2つの対象者がいます：問題をデバッグする開発者と障害から回復するエージェントです。エージェントにとって、エラーメッセージはアクション可能でなければなりません。何が問題で、どう修正するかをエージェントに伝える必要があります。

リカバリーを可能にするエラーメッセージを設計してください。再試行可能なエラーには再試行のガイダンスを含めてください。入力エラーには修正されたフォーマットを含めてください。不足データにはどのデータが必要かを含めてください。

### ツール定義スキーマ

すべてのツールで一貫したスキーマを使用してください。命名規則を確立します：ツール名には動詞-名詞パターン、ツール間で一貫したパラメータ名、一貫した戻り値フィールド名。

### ツールコレクション設計

研究によると、ツール記述の重複はモデルの混乱を引き起こします。ツールが多いほど常に良い結果につながるわけではありません。ほとんどのアプリケーションでは10〜20個のツールが妥当なガイドラインです。それ以上必要な場合は、名前空間を使用して論理的なグループを作成してください。

エージェントが適切なツールを選択するのを助けるメカニズムを実装してください：ツールのグルーピング、例ベースの選択、専門的なサブツールにルーティングするアンブレラツールによる階層構造。

### MCPツール命名要件

MCP（Model Context Protocol）ツールを使用する場合は、「ツールが見つかりません」エラーを回避するために、常に完全修飾ツール名を使用してください。

フォーマット：`ServerName:tool_name`

```python
# Correct: Fully qualified names
"Use the BigQuery:bigquery_schema tool to retrieve table schemas."
"Use the GitHub:create_issue tool to create issues."

# Incorrect: Unqualified names
"Use the bigquery_schema tool..."  # May fail with multiple servers
```

サーバープレフィックスがないと、特に複数のMCPサーバーが利用可能な場合、エージェントがツールを見つけられない可能性があります。すべてのツール参照にサーバーコンテキストを含む命名規則を確立してください。

### エージェントによるツール最適化

Claudeは自身のツールを最適化できます。ツールと観察された障害モードが与えられると、問題を診断し改善を提案します。本番テストでは、このアプローチにより将来のエージェントがミスを回避するのを助け、タスク完了時間を40%削減することが示されています。

**ツールテストエージェントパターン**：

```python
def optimize_tool_description(tool_spec, failure_examples):
    """
    Use an agent to analyze tool failures and improve descriptions.
    
    Process:
    1. Agent attempts to use tool across diverse tasks
    2. Collect failure modes and friction points
    3. Agent analyzes failures and proposes improvements
    4. Test improved descriptions against same tasks
    """
    prompt = f"""
    Analyze this tool specification and the observed failures.
    
    Tool: {tool_spec}
    
    Failures observed:
    {failure_examples}
    
    Identify:
    1. Why agents are failing with this tool
    2. What information is missing from the description
    3. What ambiguities cause incorrect usage
    
    Propose an improved tool description that addresses these issues.
    """
    
    return get_agent_response(prompt)
```

これによりフィードバックループが生まれます：ツールを使用するエージェントが障害データを生成し、それをエージェントがツール記述の改善に使用し、将来の障害を減らします。

### ツール設計のテスト

ツール設計を以下の基準に対して評価してください：曖昧さのなさ、完全性、回復可能性、効率性、一貫性。代表的なエージェントリクエストを提示し、結果として得られるツール呼び出しを評価することでツールをテストしてください。

## 実践的ガイダンス

### 避けるべきアンチパターン

曖昧な記述：「顧客情報についてデータベースを検索する」は多くの質問に答えていません。

暗号的なパラメータ名：x、val、param1というパラメータはエージェントに意味を推測させます。

エラーハンドリングの欠如：一般的なエラーで失敗するツールはリカバリーのガイダンスを提供しません。

一貫性のない命名：一部のツールでid、別のツールでidentifier、さらに別のツールでcustomer_idを使用すると混乱を招きます。

### ツール選択フレームワーク

ツールコレクションを設計する際：
1. エージェントが達成すべき個別のワークフローを特定する
2. 関連するアクションを包括的なツールにグループ化する
3. 各ツールが明確で曖昧さのない目的を持つようにする
4. エラーケースとリカバリーパスをドキュメント化する
5. 実際のエージェントインタラクションでテストする

## 例

**例1：適切に設計されたツール**
```python
def get_customer(customer_id: str, format: str = "concise"):
    """
    Retrieve customer information by ID.
    
    Use when:
    - User asks about specific customer details
    - Need customer context for decision-making
    - Verifying customer identity
    
    Args:
        customer_id: Format "CUST-######" (e.g., "CUST-000001")
        format: "concise" for key fields, "detailed" for complete record
    
    Returns:
        Customer object with requested fields
    
    Errors:
        NOT_FOUND: Customer ID not found
        INVALID_FORMAT: ID must match CUST-###### pattern
    """
```

**例2：不適切なツール設計**

この例はツール設計のアンチパターンをいくつか示しています：

```python
def search(query):
    """Search the database."""
    pass
```

**この設計の問題点：**

1. **曖昧な名前**：「search」は曖昧 - 何を、何の目的で検索するのか？
2. **パラメータの欠如**：どのデータベース？クエリはどのフォーマットにすべきか？
3. **戻り値の記述なし**：この関数は何を返すのか？リスト？文字列？エラーハンドリングは？
4. **使用コンテキストなし**：エージェントはいつこれを他のツールの代わりに使用すべきか？
5. **エラーハンドリングなし**：データベースが利用できない場合はどうなるか？

**障害モード：**
- エージェントがより具体的なツールを使用すべき場合にこのツールを呼び出す可能性がある
- エージェントが正しいクエリフォーマットを判断できない
- エージェントが結果を解釈できない
- エージェントが障害から回復できない

## ガイドライン

1. 何を、いつ、何を返すかに答える記述を書く
2. 曖昧さを減らすために統合を使用する
3. トークン効率のためにレスポンスフォーマットオプションを実装する
4. エージェントのリカバリーのためにエラーメッセージを設計する
5. 一貫した命名規則を確立し従う
6. ツール数を制限し、整理のために名前空間を使用する
7. 実際のエージェントインタラクションでツール設計をテストする
8. 観察された障害モードに基づいて反復する
9. 各ツールがモデルを有効にしているか制約しているかを検討する
10. 専門化されたラッパーよりもプリミティブで汎用的なツールを優先する
11. ツールの洗練さよりもドキュメントの品質に投資する
12. モデルの改善から恩恵を受ける最小限のアーキテクチャを構築する

## 統合

このスキルは以下と関連します：
- context-fundamentals - ツールとコンテキストの相互作用
- multi-agent-patterns - エージェントごとの専門化されたツール
- evaluation - ツールの有効性評価

## 参考資料

内部参考資料：
- [ベストプラクティスリファレンス](./references/best_practices.md) - 詳細なツール設計ガイドライン
- [アーキテクチャ削減ケーススタディ](./references/architectural_reduction.md) - ツールミニマリズムの本番実績

このコレクション内の関連スキル：
- context-fundamentals - ツールコンテキストの相互作用
- evaluation - ツールテストパターン

外部リソース：
- MCP（Model Context Protocol）ドキュメント
- フレームワークツール規則
- エージェント向けAPI設計のベストプラクティス
- Vercel d0エージェントアーキテクチャのケーススタディ

---

## スキルメタデータ

**作成日**: 2025-12-20
**最終更新日**: 2025-12-23
**著者**: Agent Skills for Context Engineering Contributors
**バージョン**: 1.1.0
